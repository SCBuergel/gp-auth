<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GnosisPay SIWE Minimal Demo</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        margin: 24px;
      }
      pre {
        background: #f6f8fa;
        padding: 12px;
        overflow: auto;
      }
      .layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        align-items: start;
      }
      .panel {
        border: 1px solid #ddd;
        padding: 16px;
        border-radius: 8px;
      }
      .explainer {
        margin-bottom: 12px;
      }
      .disclaimer {
        background: #fff3cd;
        border: 1px solid #ffec99;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 16px;
      }
      .stack button {
        display: block;
        width: 100%;
        margin: 0 0 8px 0;
      }
      .step-active {
        font-weight: 700;
      }
      .field {
        margin-bottom: 12px;
      }
      .field label {
        display: block;
        margin-bottom: 4px;
      }
      textarea,
      input[type="text"],
      input[type="number"] {
        width: 100%;
        box-sizing: border-box;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #e5e5e5;
        padding: 8px;
        vertical-align: top;
      }
      th {
        background: #f6f8fa;
        text-align: left;
      }
      .section-title {
        margin: 16px 0 8px;
      }
      .row {
        margin: 12px 0;
      }
      .muted {
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>GnosisPay Authentication Demo</h1>

    <div class="disclaimer">
      <strong>WARNING:</strong> This UI is for educational and security
      research purposes only. Do not use it with production user data or cards.
      No guarantees are made regarding correctness or security. Use at your own risk.
    </div>

    <div class="layout">
      <div class="panel">
        <div class="explainer">
          Click each step in order to complete the flow. Each action prepares the
          next step, so proceed top to bottom.
        </div>
        <div class="row stack">
          <button id="connectBtn">1) Connect Wallet</button>
          <button id="nonceBtn">2) Fetch Nonce</button>
          <button id="signBtn">3) Sign SIWE</button>
          <button id="authBtn">4) Gnosis Pay Login</button>
          <button id="cardsBtn">5) Fetch Cards</button>
          <button id="pseTokenBtn">6) Fetch PSE Token</button>
          <button id="pseBtn">7) Fetch PSE Ephemeral Token</button>
          <button id="publicKeyBtn">8) Fetch PSE Public Key</button>
          <button id="detailsBtn">9) Fetch Card Details</button>
          <button id="txBtn">10) Fetch Transactions</button>
        </div>

        <div class="section-title"><strong>Read-only outputs</strong></div>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Step(s)</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Address</td>
              <td>1</td>
              <td><span id="address">-</span></td>
            </tr>
            <tr>
              <td>Nonce (fetched)</td>
              <td>2</td>
              <td><span id="nonce">-</span></td>
            </tr>
            <tr>
              <td>Token</td>
              <td>4</td>
              <td><span id="token" class="muted">-</span></td>
            </tr>
            <tr>
              <td>PSE Token</td>
              <td>6</td>
              <td><span id="pseToken" class="muted">-</span></td>
            </tr>
            <tr>
              <td>PSE Ephemeral Token</td>
              <td>7</td>
              <td><span id="ephemeralToken" class="muted">-</span></td>
            </tr>
            <tr>
              <td>PSE Expires At</td>
              <td>7</td>
              <td><span id="ephemeralExpires">-</span></td>
            </tr>
            <tr>
              <td>PSE Public Key</td>
              <td>8</td>
              <td><span id="psePublicKey" class="muted">-</span></td>
            </tr>
          </tbody>
        </table>

        <div class="row">
          <div class="section-title"><strong>Overrides</strong></div>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Step(s)</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Domain</td>
                <td>3</td>
                <td><input id="domainInput" type="text" value="canihazauth.info" /></td>
              </tr>
              <tr>
                <td>URI</td>
                <td>3</td>
                <td><input id="uriInput" type="text" value="https://canihazauth.com" /></td>
              </tr>
              <tr>
                <td>Statement</td>
                <td>3</td>
                <td>
                  <input
                    id="statementInput"
                    type="text"
                    value="Sign in with a totally legit wallet to CAN I HAZ AUTH!!!??!?!?"
                  />
                </td>
              </tr>
              <tr>
                <td>Use SIWE library</td>
                <td>3</td>
                <td><input id="useSiweLibInput" type="checkbox" checked /></td>
              </tr>
              <tr>
                <td>Nonce (override)</td>
                <td>2, 3</td>
                <td><input id="nonceInput" type="text" value="000" /></td>
              </tr>
              <tr>
                <td>Login Message (override)</td>
                <td>3, 4</td>
                <td><textarea id="messageInput" rows="4"></textarea></td>
              </tr>
              <tr>
                <td>Login Signature (override)</td>
                <td>3, 4</td>
                <td><textarea id="signatureInput" rows="2"></textarea></td>
              </tr>
              <tr>
                <td>TTL seconds (override)</td>
                <td>4</td>
                <td><input id="ttlInput" type="number" value="36000" /></td>
              </tr>
              <tr>
                <td>Card Token (override)</td>
                <td>5, 9</td>
                <td><input id="cardTokenInput" type="text" value="" /></td>
              </tr>
              <tr>
                <td>Encrypted Key (override)</td>
                <td>9</td>
                <td>
                  <input
                    id="encryptedKeyInput"
                    type="text"
                    value="PExKDcKvSaiVlfhGGJaBpv8dmRkIDITUkpnjibLxqbqt6cz44Wp1qhUEGDYUb0WyROxXpeIjfYjMyhhS7dIhVDVXmGlKhMu6MaNAluck0yDuPYIhs4JabAjd4C6tiWbo36iCugOVHJ1bGQ50Fl1ecUkwHWMhX4HT4Y20YQPT2iw%3D"
                  />
                </td>
              </tr>
              <tr>
                <td>PSE App ID (override)</td>
                <td>6</td>
                <td>
                  <input
                    id="pseAppIdInput"
                    type="text"
                    value="gp_a1b2c3d4e5f678901234567890123456"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <div class="row">
          <strong>Logs</strong>
          <pre id="log"></pre>
        </div>

        <div class="row">
          <strong>Transactions</strong>
          <pre id="tx"></pre>
        </div>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>
